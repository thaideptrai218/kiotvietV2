<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - Kiotviet</title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" th:href="@{/modules/auth/css/register.css}">
</head>
<body>
<div class="register-wrapper">
  <div class="register-card">
    <!-- Header -->
    <div class="register-header">
      <h1><i class="fas fa-store"></i> Kiotviet</h1>
      <p>Create Your Account</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="progress-step active" id="progressStep1">
        <div class="step-number">1</div>
        <span>Personal</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" id="progressStep2">
        <div class="step-number">2</div>
        <span>Company</span>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step" id="progressStep3">
        <div class="step-number">3</div>
        <span>Account</span>
      </div>
    </div>

    <!-- Global Error -->
    <div id="globalErrorAlert" class="alert alert-danger" role="alert" style="display: none;">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="globalErrorMessage"></span>
    </div>

    <!-- Form -->
    <form id="registrationForm" th:action="@{/api/auth/register}" th:object="${registrationRequest}" method="post">
      <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger mb-3">
        <strong>Please fix the following errors:</strong>
        <ul class="mb-0 mt-2">
          <li th:each="error : ${#fields.errors('*')}" th:text="${error}"></li>
        </ul>
      </div>

      <!-- Step 1: Personal -->
      <div id="step1" class="step-pane active">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-user input-icon"></i>
              <input type="text" class="form-control" id="fullName" th:field="*{fullName}" placeholder="Full Name" data-validation="">
              <div class="field-error" th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-phone input-icon"></i>
              <input type="tel" class="form-control" id="phone" th:field="*{phone}" placeholder="Phone Number" data-validation="phone">
              <div class="field-error" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group">
              <i class="fas fa-user-tag input-icon"></i>
              <input type="text" class="form-control" id="username" th:field="*{username}" placeholder="Username *" data-validation="required,username">
              <div class="field-error" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-4">
          <button type="button" class="btn btn-primary" onclick="goToStep(2)">Next</button>
        </div>
      </div>

      <!-- Step 2: Company -->
      <div id="step2" class="step-pane">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-building input-icon"></i>
              <input type="text" class="form-control" id="companyName" th:field="*{companyName}" placeholder="Company Name *" data-validation="required">
              <div class="field-error" th:if="${#fields.hasErrors('companyName')}" th:errors="*{companyName}"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-envelope input-icon"></i>
              <input type="email" class="form-control" id="companyEmail" th:field="*{companyEmail}" placeholder="Company Email" data-validation="email">
              <div class="field-error" th:if="${#fields.hasErrors('companyEmail')}" th:errors="*{companyEmail}"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-phone-alt input-icon"></i>
              <input type="tel" class="form-control" id="companyPhone" th:field="*{companyPhone}" placeholder="Company Phone" data-validation="phone">
              <div class="field-error" th:if="${#fields.hasErrors('companyPhone')}" th:errors="*{companyPhone}"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-file-invoice input-icon"></i>
              <input type="text" class="form-control" id="taxCode" th:field="*{taxCode}" placeholder="Tax Code">
              <div class="field-error" th:if="${#fields.hasErrors('taxCode')}" th:errors="*{taxCode}"></div>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group">
              <i class="fas fa-map-marker-alt input-icon"></i>
              <textarea class="form-control" id="companyAddress" th:field="*{companyAddress}" placeholder="Company Address" rows="3"></textarea>
              <div class="field-error" th:if="${#fields.hasErrors('companyAddress')}" th:errors="*{companyAddress}"></div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-between mt-4">
          <button type="button" class="btn btn-outline-secondary" onclick="goToStep(1)">Back</button>
          <button type="button" class="btn btn-primary" onclick="goToStep(3)">Next</button>
        </div>
      </div>

      <!-- Step 3: Account -->
      <div id="step3" class="step-pane">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-envelope input-icon"></i>
              <input type="email" class="form-control" id="email" th:field="*{email}" placeholder="Login Email *" data-validation="required,email">
              <div class="field-error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <i class="fas fa-lock input-icon"></i>
              <input type="password" class="form-control" id="password" th:field="*{password}" placeholder="Password *" data-validation="required,password">
              <div class="field-error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
              <div class="password-strength" id="passwordStrength"></div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-between mt-4">
          <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2)">Back</button>
          <button type="submit" class="btn btn-success">
            <span class="button-text"><i class="fas fa-user-plus"></i> Create Account</span>
            <span class="loading-spinner"><div class="spinner-border spinner-border-sm"></div> Creating...</span>
          </button>
        </div>
      </div>
    </form>

    <!-- Sign In Link -->
    <div class="text-center mt-4">
      <small class="text-muted">Already have an account? <a th:href="@{/auth/login}" class="text-link">Sign in</a></small>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/modules/auth/js/register.js}"></script>
</body>
</html>