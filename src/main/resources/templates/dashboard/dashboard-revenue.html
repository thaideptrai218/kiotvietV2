<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Analytics - KiotViet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css}">
    <link rel="stylesheet" href="/css/header-nav.css" th:href="@{/css/header-nav.css}">
    <link rel="stylesheet" href="/css/dashboard-revenue.css" th:href="@{/css/dashboard-revenue.css}">
    <link rel="stylesheet" href="/css/dashboard-revenue-enhanced.css" th:href="@{/css/dashboard-revenue-enhanced.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header Component -->
    <div th:replace="~{common/header :: dashboardHeader}"></div>

    <!-- Navigation Component -->
    <div th:replace="~{common/navigation :: dashboardNav('revenue')}"></div>

    <!-- Main Content -->
    <main class="dashboard-container">
        <!-- Top Toolbar: Title & Actions -->
        <header class="dashboard-header">
            <div class="header-title-group">
                <h1>Revenue Analytics</h1>
                <p class="subtitle">Financial performance and business insights</p>
            </div>
            <div class="header-actions-group">
                <div class="date-controls">
                    <select id="periodSelector" class="form-select">
                        <option value="today">Today</option>
                        <option value="thisWeek" selected>This Week</option>
                        <option value="thisMonth">This Month</option>
                        <option value="thisQuarter">This Quarter</option>
                        <option value="thisYear">This Year</option>
                    </select>
                    <div class="date-picker-wrapper">
                        <input type="date" id="startDate" class="form-input-date">
                        <span class="separator">-</span>
                        <input type="date" id="endDate" class="form-input-date">
                    </div>
                </div>
                <div class="button-group">
                    <button id="refreshData" class="btn btn-secondary btn-icon" title="Refresh Data">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="exportReport" class="btn btn-primary">
                        <i class="fas fa-download"></i>
                        <span>Export</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- KPI Grid -->
        <section class="kpi-grid">
            <!-- Revenue -->
            <div class="kpi-card primary">
                <div class="kpi-icon-wrapper">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Total Revenue</div>
                    <div class="kpi-value" id="revenueAmount">₫0</div>
                    <div class="kpi-footer">
                        <span class="kpi-trend" id="growthPercentage">
                            <i id="growthIcon" class="fas fa-arrow-up"></i> 0%
                        </span>
                        <span class="kpi-period" id="revenuePeriod">vs last period</span>
                    </div>
                </div>
            </div>

            <!-- Orders -->
            <div class="kpi-card blue">
                <div class="kpi-icon-wrapper">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Total Orders</div>
                    <div class="kpi-value" id="ordersCount">0</div>
                    <div class="kpi-footer">
                        <span class="kpi-meta" id="ordersPeriod">This Week</span>
                    </div>
                </div>
            </div>

            <!-- Customers -->
            <div class="kpi-card green">
                <div class="kpi-icon-wrapper">
                    <i class="fas fa-users"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Customers</div>
                    <div class="kpi-value" id="customersCount">0</div>
                    <div class="kpi-footer">
                        <span class="kpi-meta" id="customersPeriod">Active this week</span>
                    </div>
                </div>
            </div>

            <!-- AOV -->
            <div class="kpi-card orange">
                <div class="kpi-icon-wrapper">
                    <i class="fas fa-receipt"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Avg. Order Value</div>
                    <div class="kpi-value" id="averageOrderValue">₫0</div>
                    <div class="kpi-footer">
                        <span class="kpi-meta" id="aovPeriod">Per order</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Charts Section -->
        <section class="charts-grid">
            <div class="card chart-card main-chart">
                <div class="card-header">
                    <h3>Revenue Trend</h3>
                    <select id="revenueChartType" class="chart-select-sm">
                        <option value="line">Line</option>
                        <option value="bar">Bar</option>
                        <option value="area">Area</option>
                    </select>
                </div>
                <div class="card-body chart-body-lg">
                    <canvas id="revenueTrendChart"></canvas>
                </div>
            </div>

            <div class="card chart-card">
                <div class="card-header">
                    <h3>Payment Methods</h3>
                </div>
                <div class="card-body chart-body-sm">
                    <canvas id="paymentMethodsChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Secondary Metrics Grid (Growth & Inventory) -->
        <section class="secondary-grid">
            <!-- Growth Stats -->
            <div class="card">
                <div class="card-header">
                    <h3>Growth Tracker</h3>
                </div>
                <div class="list-group">
                    <div class="list-item">
                        <div class="list-content">
                            <span class="list-title">Daily Growth</span>
                            <span class="list-subtitle">vs Yesterday</span>
                        </div>
                        <div class="list-value" id="dailyGrowth">--</div>
                    </div>
                    <div class="list-item">
                        <div class="list-content">
                            <span class="list-title">Weekly Growth</span>
                            <span class="list-subtitle">vs Last Week</span>
                        </div>
                        <div class="list-value" id="weeklyGrowth">--</div>
                    </div>
                    <div class="list-item">
                        <div class="list-content">
                            <span class="list-title">Monthly Growth</span>
                            <span class="list-subtitle">vs Last Month</span>
                        </div>
                        <div class="list-value" id="monthlyGrowth">--</div>
                    </div>
                </div>
            </div>

            <!-- Inventory Health -->
            <div class="card">
                <div class="card-header">
                    <h3>Inventory Health</h3>
                </div>
                <div class="list-group">
                    <div class="list-item">
                        <div class="list-content">
                            <span class="list-title">Total Products</span>
                        </div>
                        <div class="list-value" id="totalProducts">0</div>
                    </div>
                    <div class="list-item warning-bg">
                        <div class="list-content">
                            <span class="list-title">Low Stock</span>
                            <span class="list-subtitle">Restock needed</span>
                        </div>
                        <div class="list-value text-warning" id="lowStockCount">0</div>
                    </div>
                    <div class="list-item danger-bg">
                        <div class="list-content">
                            <span class="list-title">Out of Stock</span>
                            <span class="list-subtitle">Missed opportunity</span>
                        </div>
                        <div class="list-value text-danger" id="outOfStockCount">0</div>
                    </div>
                </div>
            </div>

            <!-- Business Overview -->
            <div class="card">
                <div class="card-header">
                    <h3>Overview</h3>
                </div>
                <div class="stat-row">
                    <div class="stat-col">
                        <span class="stat-label">Suppliers</span>
                        <span class="stat-num" id="totalSuppliers">0</span>
                    </div>
                    <div class="stat-col">
                        <span class="stat-label">Total Customers</span>
                        <span class="stat-num" id="totalCustomers">0</span>
                    </div>
                </div>
                <div class="stat-full">
                    <span class="stat-label">Est. Inventory Value</span>
                    <span class="stat-num primary-text" id="totalInventoryValue">₫0</span>
                </div>
            </div>
        </section>

        <!-- Top Performers Tables -->
        <section class="tables-grid">
            <!-- Top Products -->
            <div class="card table-card">
                <div class="card-header">
                    <h3>Top Products</h3>
                    <a href="/products" class="link-sm">View All</a>
                </div>
                <div class="card-body p-0">
                    <div class="custom-table" id="topProductsList">
                        <!-- JS Populated -->
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                    </div>
                </div>
            </div>

            <!-- Top Categories -->
            <div class="card table-card">
                <div class="card-header">
                    <h3>Top Categories</h3>
                    <a href="/categories" class="link-sm">View All</a>
                </div>
                <div class="card-body p-0">
                    <div class="custom-table" id="topCategoriesList">
                        <!-- JS Populated -->
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                    </div>
                </div>
            </div>
             <!-- Top Customers -->
             <div class="card table-card">
                <div class="card-header">
                    <h3>Top Customers</h3>
                    <a href="/customers" class="link-sm">View All</a>
                </div>
                <div class="card-body p-0">
                    <div class="custom-table" id="topCustomersList">
                        <!-- JS Populated -->
                        <div class="skeleton-row"></div>
                        <div class="skeleton-row"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hidden fields for JS compatibility if needed -->
        <div style="display:none;">
            <span id="itemsSold"></span>
            <span id="itemsPeriod"></span>
            <span id="conversionRate"></span>
            <span id="conversionPeriod"></span>
            <span id="yearlyGrowth"></span>
        </div>

    </main>

    <script th:src="@{/modules/dashboard/js/dashboard-revenue.js}"></script>
</body>
</html>
