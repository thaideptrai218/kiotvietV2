<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title th:text="${title} ?: 'Admin Panel - KiotViet'">
            Admin Panel - KiotViet
        </title>
    </head>
    <body>
        <!-- Modern Admin Header with Navigation Fragment -->
        <header
            th:fragment="modernAdminHeader(title, activePage)"
            class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm"
        >
            <!-- Tailwind CSS CDN (if not already included in parent page) -->
            <script
                th:if="${includeTailwind}"
                src="https://cdn.tailwindcss.com"
            ></script>

            <!-- Lucide Icons (if not already included in parent page) -->
            <script
                th:if="${includeLucide}"
                src="https://unpkg.com/lucide@latest"
            ></script>

            <!-- Main Header Bar -->
            <div class="bg-gradient-to-r from-purple-600 to-purple-700">
                <div class="max-w-[1600px] mx-auto px-4 md:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <!-- Logo Section -->
                        <a
                            href="/admin/dashboard"
                            th:href="@{/admin/dashboard}"
                            class="flex items-center gap-3 text-white hover:opacity-90 transition-opacity"
                        >
                            <i data-lucide="shield" class="w-6 h-6"></i>
                            <span class="font-bold text-lg font-heading"
                                >KiotViet Admin</span
                            >
                        </a>

                        <!-- Mobile Menu Button -->
                        <button
                            onclick="toggleMobileMenu()"
                            class="md:hidden p-2 text-white hover:bg-purple-800 rounded-lg transition-colors"
                        >
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>

                        <!-- Desktop Right Section -->
                        <div class="hidden md:flex items-center gap-4">
                            <!-- System Admin Badge -->
                            <div
                                class="flex items-center gap-2 px-3 py-1.5 bg-red-500/20 border border-red-400/30 rounded-lg text-white text-sm font-medium"
                            >
                                <i
                                    data-lucide="shield-check"
                                    class="w-4 h-4"
                                ></i>
                                <span>System Admin</span>
                            </div>

                            <!-- Back to App -->
                            <a
                                href="/dashboard"
                                th:href="@{/dashboard}"
                                class="flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm transition-colors"
                                title="Back to Main App"
                            >
                                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                                <span>App</span>
                            </a>

                            <!-- User Dropdown -->
                            <div class="relative">
                                <button
                                    onclick="toggleUserDropdown()"
                                    class="flex items-center gap-2 p-2 hover:bg-white/10 rounded-lg transition-colors"
                                >
                                    <div
                                        class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white"
                                    >
                                        <i
                                            data-lucide="user"
                                            class="w-4 h-4"
                                        ></i>
                                    </div>
                                </button>

                                <!-- Dropdown Menu -->
                                <div
                                    id="userDropdown"
                                    class="hidden absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden"
                                >
                                    <div class="p-4 border-b border-gray-200">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center"
                                            >
                                                <i
                                                    data-lucide="shield-check"
                                                    class="w-5 h-5 text-purple-600"
                                                ></i>
                                            </div>
                                            <div>
                                                <div
                                                    class="font-semibold text-gray-900"
                                                    id="userName"
                                                >
                                                    Loading...
                                                </div>
                                                <div
                                                    class="text-sm text-gray-600"
                                                    id="userEmail"
                                                >
                                                    Loading...
                                                </div>
                                                <div
                                                    class="text-xs text-purple-600 font-medium mt-0.5"
                                                >
                                                    System Administrator
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-2">
                                        <a
                                            href="/profile"
                                            th:href="@{/profile}"
                                            class="flex items-center gap-3 px-3 py-2 hover:bg-gray-50 rounded-lg transition-colors text-gray-700"
                                        >
                                            <i
                                                data-lucide="user-cog"
                                                class="w-4 h-4"
                                            ></i>
                                            <span>Edit Profile</span>
                                        </a>
                                    </div>
                                    <div class="border-t border-gray-200 p-2">
                                        <button
                                            onclick="handleLogout()"
                                            class="w-full flex items-center gap-3 px-3 py-2 hover:bg-red-50 rounded-lg transition-colors text-red-600"
                                        >
                                            <i
                                                data-lucide="log-out"
                                                class="w-4 h-4"
                                            ></i>
                                            <span>Logout</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Bar -->
            <div class="bg-white border-b border-gray-200">
                <div class="max-w-[1600px] mx-auto px-4 md:px-6 lg:px-8">
                    <!-- Desktop Navigation -->
                    <nav class="hidden md:flex items-center gap-1">
                        <a
                            th:href="@{/admin/dashboard}"
                            th:classappend="${activePage == 'dashboard'} ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600 hover:text-gray-900'"
                            class="flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="chart-line" class="w-4 h-4"></i>
                            <span>Dashboard</span>
                        </a>
                        <a
                            th:href="@{/admin/companies}"
                            th:classappend="${activePage == 'companies'} ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600 hover:text-gray-900'"
                            class="flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="building-2" class="w-4 h-4"></i>
                            <span>Companies</span>
                        </a>
                        <a
                            th:href="@{/admin/users}"
                            th:classappend="${activePage == 'users'} ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600 hover:text-gray-900'"
                            class="flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="users" class="w-4 h-4"></i>
                            <span>Users</span>
                        </a>
                    </nav>

                    <!-- Mobile Navigation -->
                    <div
                        id="mobileMenu"
                        class="hidden md:hidden py-2 space-y-1"
                    >
                        <a
                            th:href="@{/admin/dashboard}"
                            th:classappend="${activePage == 'dashboard'} ? 'bg-purple-50 text-purple-600 border-l-4 border-purple-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="chart-line" class="w-4 h-4"></i>
                            <span>Dashboard</span>
                        </a>
                        <a
                            th:href="@{/admin/companies}"
                            th:classappend="${activePage == 'companies'} ? 'bg-purple-50 text-purple-600 border-l-4 border-purple-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="building-2" class="w-4 h-4"></i>
                            <span>Companies</span>
                        </a>
                        <a
                            th:href="@{/admin/users}"
                            th:classappend="${activePage == 'users'} ? 'bg-purple-50 text-purple-600 border-l-4 border-purple-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors"
                        >
                            <i data-lucide="users" class="w-4 h-4"></i>
                            <span>Users</span>
                        </a>
                        <div class="border-t border-gray-200 mt-2 pt-2">
                            <a
                                th:href="@{/dashboard}"
                                class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors"
                            >
                                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                                <span>Back to App</span>
                            </a>
                            <button
                                onclick="handleLogout()"
                                class="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-red-600 hover:bg-red-50 transition-colors"
                            >
                                <i data-lucide="log-out" class="w-4 h-4"></i>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <script th:src="@{/core/js/auth.js}"></script>
            <script>
                // Initialize Lucide icons when header loads
                document.addEventListener("DOMContentLoaded", function () {
                    if (typeof lucide !== "undefined") {
                        lucide.createIcons();
                    }
                    loadUserInfo();
                });

                // Toggle mobile menu
                function toggleMobileMenu() {
                    const menu = document.getElementById("mobileMenu");
                    if (menu) {
                        menu.classList.toggle("hidden");
                    }
                }

                // Toggle user dropdown
                function toggleUserDropdown() {
                    const dropdown = document.getElementById("userDropdown");
                    if (dropdown) {
                        dropdown.classList.toggle("hidden");
                    }
                }

                // Close dropdowns when clicking outside
                document.addEventListener("click", function (event) {
                    const dropdown = document.getElementById("userDropdown");
                    const button = event.target.closest(
                        'button[onclick="toggleUserDropdown()"]',
                    );

                    if (
                        dropdown &&
                        !dropdown.contains(event.target) &&
                        !button
                    ) {
                        dropdown.classList.add("hidden");
                    }
                });

                // Load user info
                async function loadUserInfo() {
                    if (typeof kiotVietAuth !== "undefined") {
                        try {
                            const isAuthenticated =
                                await kiotVietAuth.isAuthenticated();
                            if (isAuthenticated) {
                                const userInfo = kiotVietAuth.getUserInfo();
                                if (userInfo) {
                                    updateUserInfo(userInfo);
                                }
                            }
                        } catch (error) {
                            console.error("Error loading user info:", error);
                        }
                    }
                }

                function updateUserInfo(user) {
                    const userName = document.getElementById("userName");
                    const userEmail = document.getElementById("userEmail");

                    if (userName)
                        userName.textContent =
                            user.username || user.fullName || "Admin";
                    if (userEmail)
                        userEmail.textContent = user.email || "No email";
                }

                // Logout handler
                function handleLogout() {
                    if (typeof kiotVietAuth !== "undefined") {
                        kiotVietAuth.logout();
                    } else {
                        window.location.href = "/login?logout=true";
                    }
                }
            </script>
        </header>
    </body>
</html>
