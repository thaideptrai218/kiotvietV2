<!-- Dashboard Navigation Fragment -->
<nav class="moduleNav" th:fragment="dashboardNav(activeLink)">
    <div class="moduleNavInner">
        <ul class="tabList" role="tablist">
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'dashboard'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'dashboard'} ? 'active' : ''"
                   href="/dashboard">
                    Dashboard
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'orders'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'orders'} ? 'active' : ''"
                   href="/order">
                    Orders
                </a>
            </li>
            <li role="presentation" class="tabItem hasMega">
                <a role="tab"
                   aria-selected="${activeLink == 'products'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'products'} ? 'active' : ''"
                   href="/products">
                    Products
                </a>
                <div class="megaDropdown" aria-label="Product mega menu">
                    <div class="megaGrid">
                        <div class="megaColumn">
                            <div class="megaTitle">Product</div>
                            <a class="megaLink" href="/products">All products</a>
                            <a class="megaLink" href="/pricebook">Price book</a>
                            <a class="megaLink" href="/stock">Stock</a>
                        </div>
                        <div class="megaColumn">
                            <div class="megaTitle">Inventory count</div>
                            <a class="megaLink" href="/inventory">Inventory count</a>
                            <a class="megaLink" href="/inventory/loss">Loss / Damage</a>
                        </div>
                        <div class="megaColumn">
                            <div class="megaTitle">Purchase</div>
                            <a class="megaLink" href="/suppliers">Supplier</a>
                            <a class="megaLink" href="/purchases">Purchase</a>
                            <a class="megaLink" href="/purchases/return">Purchase return</a>
                        </div>
                    </div>
                </div>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'purchases'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'purchases'} ? 'active' : ''"
                   href="/purchases">
                    Purchases
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'suppliers'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'suppliers'} ? 'active' : ''"
                   href="/suppliers">
                    Suppliers
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'customers'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'customers'} ? 'active' : ''"
                   href="/customers">
                    Customers
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'tax'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'tax'} ? 'active' : ''"
                   href="/tax">
                    Tax & Accounting
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'crm'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'crm'} ? 'active' : ''"
                   href="/crm">
                    CRM
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'reports'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'reports'} ? 'active' : ''"
                   href="/reports">
                    Reports
                </a>
            </li>
            <li role="presentation">
                <a role="tab"
                   aria-selected="${activeLink == 'employees'} ? 'true' : 'false'"
                   class="tab"
                   th:classappend="${activeLink == 'employees'} ? 'active' : ''"
                   href="/employees">
                    Employees
                </a>
            </li>
        </ul>
    </div>
</nav>
<script>
    (function () {
        function initMegaNav() {
            const nav = document.querySelector('.moduleNav');
            if (!nav || nav.dataset.megaBound === 'true') return;
            nav.dataset.megaBound = 'true';

            const tabItems = nav.querySelectorAll('.tabList > li');
            tabItems.forEach((item) => {
                const dropdown = item.querySelector('.megaDropdown');
                let openTimer = null;
                let closeTimer = null;

                const clearTimers = () => {
                    if (openTimer) {
                        clearTimeout(openTimer);
                        openTimer = null;
                    }
                    if (closeTimer) {
                        clearTimeout(closeTimer);
                        closeTimer = null;
                    }
                };

                const open = () => {
                    clearTimers();
                    openTimer = setTimeout(() => {
                        item.classList.add('hovered');
                        if (dropdown) dropdown.classList.add('open');
                    }, 180);
                };

                const close = () => {
                    clearTimers();
                    closeTimer = setTimeout(() => {
                        const hoveringItem = item.matches(':hover');
                        const hoveringDropdown = dropdown && dropdown.matches(':hover');
                        if (hoveringItem || hoveringDropdown) return;
                        item.classList.remove('hovered');
                        if (dropdown) dropdown.classList.remove('open');
                    }, 200);
                };

                item.addEventListener('mouseenter', open);
                item.addEventListener('mouseleave', close);

                if (dropdown) {
                    dropdown.addEventListener('mouseenter', open);
                    dropdown.addEventListener('mouseleave', close);
                }
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMegaNav);
        } else {
            initMegaNav();
        }
    })();
</script>
