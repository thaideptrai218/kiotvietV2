name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]
    # Optional: Only run on specific file changes
    paths:
      - "src/**/*.java"
      - "src/main/resources/**"
      - "pom.xml"
      - "CLAUDE.md"

jobs:
  claude-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write # Required to post comments
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Get full history for better review context

      - name: Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            Please review this pull request and provide feedback on:

            **PR Details:**
            Repository: ${{ github.repository }}
            PR Number: ${{ github.event.pull_request.number }}
            PR Author: ${{ github.event.pull_request.user.login }}

            **Review Focus Areas:**
            - Code quality and best practices
            - Potential bugs or issues
            - Performance considerations
            - Security concerns
            - Test coverage
            - Adherence to project conventions (see CLAUDE.md)

            **Instructions:**
            1. Review the code changes carefully
            2. Provide constructive, helpful feedback
            3. Post your review as a comment on the PR
            4. Focus on the most important issues first
            5. Be specific and actionable in your feedback

            Use the repository's CLAUDE.md for guidance on style and conventions.
          claude_args: "--verbose --output-format stream-json"
          anthropic_api_key: 828515b7cefd4ab8abbb739f263cb460.Si3Jxi3AYt6MhzTM
        env:
          ANTHROPIC_BASE_URL: https://api.z.ai/api/anthropic

