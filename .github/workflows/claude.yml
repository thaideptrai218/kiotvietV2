name: Claude Code Assistant

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write # Required for commenting
      issues: write # Required for commenting on issues
      id-token: write
      actions: read # Required for Claude to read CI results on PRs

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Assistant
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            You are Claude Code Assistant helping with this GitHub repository. Please respond to the following:

            **Context:**
            Event Type: ${{ github.event_name }}
            Repository: ${{ github.repository }}
            Actor: ${{ github.actor }}

            **Request:**
            ${{
              github.event_name == 'issue_comment' && format('Issue Comment: "{0}" by {1}', github.event.comment.body, github.event.comment.user.login) ||
              github.event_name == 'pull_request_review_comment' && format('PR Review Comment: "{0}" by {1}', github.event.comment.body, github.event.comment.user.login) ||
              github.event_name == 'pull_request_review' && format('PR Review: "{0}" by {1}', github.event.review.body, github.event.review.user.login) ||
              github.event_name == 'issues' && format('Issue: "{0}" - {1}', github.event.issue.title, github.event.issue.body)
            }}

            **Instructions:**
            1. Analyze the request and provide helpful assistance
            2. If it's a code question, reference relevant files in the repository
            3. If it's about project structure, use the CLAUDE.md file for guidance
            4. Provide actionable solutions or explanations
            5. Post your response as a comment on the issue/PR

            Focus on being helpful, technical, and solution-oriented.
          claude_args: "--verbose --output-format stream-json --allowed-tools Bash(gh:*),Read,Grep,Glob"
        env:
          ANTHROPIC_API_KEY: 828515b7cefd4ab8abbb739f263cb460.Si3Jxi3AYt6MhzTM
          ANTHROPIC_BASE_URL: https://api.z.ai/api/anthropic

